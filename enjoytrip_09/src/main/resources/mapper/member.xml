<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.enjoytrip.member.model.mapper.MemberMapper">

	<select id="loginMember" parameterType="string" resultType="memberDto">
		select user_id userId, user_name userName, user_password userPass
		from trip_member
		where user_id = #{userId} and user_password = #{userPass} 
	</select>
	
	<update id="updateMember" parameterType="memberDto">
		update trip_member
		set user_id = #{userId}, user_password = #{userPass}, user_name = #{userName}, user_nickname = #{userNickname}, user_email = #{userEmail}, user_domain = #{userDomain}
		where user_id = #{userId}
	</update>

	<insert id="joinMember" parameterType="memberDto">
		insert into trip_member (user_id, user_name, user_password)
		values (#{userId}, #{userPass}, #{userName})
	</insert>
	
	<delete id="delete" parameterType="string">
		delete from trip_member
		where user_id = #{userId}
	</delete>
	
	<select id="getMyInfo" parameterType="string" resultType="memberDto">
		select user_id userId, user_name userName, user_password userPass
		from trip_member
		where user_id = #{userId}
	</select>
	
	<!-- 마이 페이지 -->
	
	<insert id="addBookmark" parameterType="string">
		insert into bookmark (plan_id, user_id)
		values (#{planId}, #{userId})
	</insert>
	
	<select id="getBookmark" parameterType="string" resultType="map">
		select user_id userId, plan_id planId, plan_title planTitle, update_time UpdateTime
		from plan_list
		where user_id = #{userId}
	</select>
	
	<delete id="deleteBookmark" parameterType="string">
		delete from bookmark
		where user_id = #{userId} AND plan_id = #{planId}
	</delete>
	
	<select id="getBookmarkDetail" parameterType="string" resultType="map">
		select a.content_id contentId, content_type_id contentTypeId, title, addr1 addr, first_image image, latitude, longitude, plan_id planId, plan_date planDate, plan_seq planSeq
		from attraction_info a join (
				select plan_id, plan_date, plan_seq, content_id
				from plan_seq
				where plan_id = #{planId}) p
			on a.content_id = p.content_id
	</select>
	
</mapper>